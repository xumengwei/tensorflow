package(default_visibility = ["//visibility:public"])

licenses(["notice"])  # Apache 2.0

load("//tensorflow:tensorflow.bzl",
     "tf_copts",
     "if_android",
     "if_not_mobile")

LINKER_SCRIPT = ":android_version_script.lds"

# bazel build //tensorflow/examples/rs_test:rs_benchmark --copt=-DSELECTIVE_REGISTRATION  --crosstool_top=//external:android/crosstool --host_crosstool_top=@bazel_tools//tools/cpp:toolchain --cpu=armeabi-v7a
cc_binary(
    name = "rs_benchmark",
    srcs = [
            "rs_benchmark.cc",
            "utils.h",
        ]
        + if_android([
            "abort_wrapper.cc",
            "//tensorflow/core:android_op_registrations_and_gradients",
            ":missing_impls",
            ":kernels_src",
          ]),
    copts = tf_copts() + [
            "-fexceptions",
            "-DSUPPORT_SELECTIVE_REGISTRATION",
          ],
    linkopts = ["-lm"] + if_android([
        "-pie",
        "-landroid",
        "-llog",
        "-lz",
        "-z defs",
        "-Wl,--version-script", LINKER_SCRIPT,
        "-Wl,--wrap=abort",
    ]),
    deps = [
        ] + if_android([
            "@gemmlowp//:gemmlowp",
            "//tensorflow/core:android_tensorflow_lib_selective_registration",
            # "//tensorflow/core/kernels:android_tensorflow_kernels",
            LINKER_SCRIPT]),
)


# These direct inclusion shall be replaced by the rules in
# //tensorflow/core/kernels:...
filegroup(
    name = "missing_impls",
    srcs = [
        "//tensorflow/core/kernels:tile_ops_impl.h",
        "//tensorflow/core/kernels:tile_ops_cpu_impl.h",
        "//tensorflow/core/kernels:tile_ops_cpu_impl_1.cc",
        "//tensorflow/core/kernels:tile_ops_cpu_impl_2.cc",
        "//tensorflow/core/kernels:tile_ops_cpu_impl_3.cc",
        "//tensorflow/core/kernels:tile_ops_cpu_impl_4.cc",
        "//tensorflow/core/kernels:tile_ops_cpu_impl_5.cc",
        "//tensorflow/core/kernels:tile_ops_cpu_impl_6.cc",
        "//tensorflow/core/kernels:tile_ops_cpu_impl_7.cc",

        "//tensorflow/core/kernels:strided_slice_op_impl.h",
        "//tensorflow/core/kernels:strided_slice_op_inst_0.cc",
        "//tensorflow/core/kernels:strided_slice_op_inst_1.cc",
        "//tensorflow/core/kernels:strided_slice_op_inst_2.cc",
        "//tensorflow/core/kernels:strided_slice_op_inst_3.cc",
        "//tensorflow/core/kernels:strided_slice_op_inst_4.cc",
        "//tensorflow/core/kernels:strided_slice_op_inst_5.cc",
        "//tensorflow/core/kernels:strided_slice_op_inst_6.cc",
        "//tensorflow/core/kernels:strided_slice_op_inst_7.cc",

        "//tensorflow/core/kernels:variable_ops.h",
        "//tensorflow/core/kernels:slice_op_cpu_impl.h",
        "//tensorflow/core/kernels:slice_op_cpu_impl_1.cc",
        "//tensorflow/core/kernels:slice_op_cpu_impl_2.cc",
        "//tensorflow/core/kernels:slice_op_cpu_impl_3.cc",
        "//tensorflow/core/kernels:slice_op_cpu_impl_4.cc",
        "//tensorflow/core/kernels:slice_op_cpu_impl_5.cc",
        "//tensorflow/core/kernels:slice_op_cpu_impl_6.cc",
        "//tensorflow/core/kernels:slice_op_cpu_impl_7.cc",

        "//tensorflow/core/kernels:function_ops.cc",
        "//tensorflow/core/kernels:cwise_op_sigmoid.cc",
    ],
)

filegroup(
    name = "kernels_src",
    srcs = [
        "//tensorflow/core/kernels:no_op.h",
        "//tensorflow/core/kernels:no_op.cc",
        "//tensorflow/core/kernels:assign_op.h",
        "//tensorflow/core/kernels:bias_op.cc",
        "//tensorflow/core/kernels:bias_op.h",
        "//tensorflow/core/kernels:bias_op_gpu.h",
        "//tensorflow/core/kernels:bounds_check.h",
        "//tensorflow/core/kernels:concat_lib.h",
        "//tensorflow/core/kernels:concat_lib_cpu.cc",
        "//tensorflow/core/kernels:concat_lib_cpu.h",
        "//tensorflow/core/kernels:concat_op.cc",
        "//tensorflow/core/kernels:constant_op.cc",
        "//tensorflow/core/kernels:constant_op.h",
        "//tensorflow/core/kernels:control_flow_ops.cc",
        "//tensorflow/core/kernels:control_flow_ops.h",
        "//tensorflow/core/kernels:cuda_device_array.h",
        "//tensorflow/core/kernels:cuda_device_array_gpu.h",
        "//tensorflow/core/kernels:cwise_op_add_1.cc",
        "//tensorflow/core/kernels:cwise_op_greater.cc",
        "//tensorflow/core/kernels:cwise_op_floor_mod.cc",
        "//tensorflow/core/kernels:cwise_op_floor.cc",
        "//tensorflow/core/kernels:cwise_op_sqrt.cc",
        "//tensorflow/core/kernels:cwise_op_less_equal.cc",
        "//tensorflow/core/kernels:cwise_op_mul_1.cc",
        "//tensorflow/core/kernels:cwise_op_select.cc",
        "//tensorflow/core/kernels:cwise_op_neg.cc",
        "//tensorflow/core/kernels:cwise_op_sub.cc",
        "//tensorflow/core/kernels:cwise_op_minimum.cc",
        "//tensorflow/core/kernels:cwise_op_div.cc",
        "//tensorflow/core/kernels:cwise_op_tanh.cc",
        "//tensorflow/core/kernels:cwise_ops.h",
        "//tensorflow/core/kernels:cwise_ops_common.cc",
        "//tensorflow/core/kernels:cwise_ops_common.h",
        "//tensorflow/core/kernels:cwise_ops_gradients.h",
        "//tensorflow/core/kernels:cwise_ops_sycl_common.h",
        "//tensorflow/core/kernels:dense_update_functor.cc",
        "//tensorflow/core/kernels:dense_update_functor.h",
        "//tensorflow/core/kernels:dense_update_ops.cc",
        "//tensorflow/core/kernels:fill_functor.cc",
        "//tensorflow/core/kernels:fill_functor.h",
        "//tensorflow/core/kernels:gather_functor.cc",
        "//tensorflow/core/kernels:gather_functor.h",
        "//tensorflow/core/kernels:gather_op.cc",
        "//tensorflow/core/kernels:identity_op.cc",
        "//tensorflow/core/kernels:identity_op.h",
        "//tensorflow/core/kernels:matmul_op.cc",
        "//tensorflow/core/kernels:matmul_op.h",
        "//tensorflow/core/kernels:mkl_matmul_op.cc",
        "//tensorflow/core/kernels:ops_util.h",
        "//tensorflow/core/kernels:pack_op.cc",
        "//tensorflow/core/kernels:reduction_ops.h",
        "//tensorflow/core/kernels:reduction_ops_common.cc",
        "//tensorflow/core/kernels:reduction_ops_common.h",
        "//tensorflow/core/kernels:reduction_ops_max.cc",
        "//tensorflow/core/kernels:reduction_ops_min.cc",
        "//tensorflow/core/kernels:reduction_ops_sum.cc",
        "//tensorflow/core/kernels:reshape_op.cc",
        "//tensorflow/core/kernels:reshape_op.h",
        "//tensorflow/core/kernels:sendrecv_ops.cc",
        "//tensorflow/core/kernels:sendrecv_ops.h",
        "//tensorflow/core/kernels:sequence_ops.cc",
        "//tensorflow/core/kernels:shape_ops.cc",
        "//tensorflow/core/kernels:shape_ops.h",
        "//tensorflow/core/kernels:slice_op.cc",
        "//tensorflow/core/kernels:slice_op.h",
        "//tensorflow/core/kernels:softmax_op.cc",
        # "//tensorflow/core/kernels:softmax_op.h",
        "//tensorflow/core/kernels:softmax_op_functor.h",
        "//tensorflow/core/kernels:split_lib.h",
        "//tensorflow/core/kernels:split_lib_cpu.cc",
        "//tensorflow/core/kernels:split_op.cc",
        "//tensorflow/core/kernels:split_v_op.cc",
        "//tensorflow/core/kernels:strided_slice_op.cc",
        "//tensorflow/core/kernels:strided_slice_op.h",
        "//tensorflow/core/kernels:strided_slice_op_impl.h",
        "//tensorflow/core/kernels:tile_ops.cc",
        "//tensorflow/core/kernels:tile_functor.h",
        "//tensorflow/core/kernels:tile_functor_cpu.cc",
        "//tensorflow/core/kernels:transpose_functor.h",
        "//tensorflow/core/kernels:transpose_functor_cpu.cc",
        "//tensorflow/core/kernels:transpose_op.cc",
        "//tensorflow/core/kernels:transpose_op.h",
        "//tensorflow/core/kernels:unpack_op.cc",
        "//tensorflow/core/kernels:variable_ops.cc",
        "//tensorflow/core/kernels:variable_ops.h",
        "//tensorflow/core/kernels:bcast_ops.cc",
        "//tensorflow/core/kernels:random_op.h",
        "//tensorflow/core/kernels:random_op.cc",
        "//tensorflow/core/kernels:l2loss_op.h",
        "//tensorflow/core/kernels:l2loss_op.cc",
        "//tensorflow/core/kernels:scatter_functor.h",
        "//tensorflow/core/kernels:scatter_op.cc",
        "//tensorflow/core/kernels:sparse_xent_op.h",
        "//tensorflow/core/kernels:sparse_xent_op.cc",
        "//tensorflow/core/kernels:aggregate_ops.h",
        "//tensorflow/core/kernels:aggregate_ops_cpu.h",
        "//tensorflow/core/kernels:aggregate_ops.cc",
        "//tensorflow/core/kernels:training_op_helpers.h",
        "//tensorflow/core/kernels:training_op_helpers.cc",
        "//tensorflow/core/kernels:training_ops.h",
        "//tensorflow/core/kernels:training_ops.cc",
        "//tensorflow/core/kernels:topk_op.cc",
        "//tensorflow/core/kernels:topk_op.h",
    ],
)
